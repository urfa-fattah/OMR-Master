<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMR Master Pro</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="OMR Master Pro">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OMR Master">
    <meta name="description" content="Professional OMR practice suite with advanced analytics, real-time tracking, and split-screen PDF support">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#2563eb">
    <meta name="msapplication-config" content="none">
    
    <!-- Demo Icon Set (Using Flaticon as placeholder) -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon.png">
    <link rel="shortcut icon" href="icon.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json" id="manifestLink">
    
    <!-- Splash Screens -->
    <link rel="apple-touch-startup-image" href="icon.png">
    
    <!-- React & Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- PWA Installation Prompt -->
    <script>
        // PWA Installation
        let deferredPrompt;
        let isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                          window.navigator.standalone ||
                          document.referrer.includes('android-app://');
        
        // Enhanced beforeinstallprompt handler
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt event fired');
            e.preventDefault();
            deferredPrompt = e;
            
            // Only show install button if not already installed
            if (!isStandalone && !localStorage.getItem('pwa-install-dismissed')) {
                setTimeout(() => {
                    showInstallPromotion();
                }, 3000);
            }
            
            // Update UI
            updatePWAStatus();
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed');
            isStandalone = true;
            updatePWAStatus();
            hideInstallPromotion();
            showToast('App installed successfully!', 'success');
        });

        function showInstallPromotion() {
            // Remove existing install button if any
            const existingBtn = document.getElementById('installBtn');
            if (existingBtn) existingBtn.remove();
            
            const installBtn = document.createElement('div');
            installBtn.id = 'installBtn';
            installBtn.innerHTML = `
                <div class="fixed bottom-20 right-4 z-50 bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 rounded-xl shadow-2xl flex items-center gap-3 animate-bounce cursor-pointer hover:scale-105 transition-transform duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    <div>
                        <span class="font-bold">Install App</span>
                        <p class="text-xs opacity-90">For better experience</p>
                    </div>
                    <button id="dismissInstall" class="ml-2 text-white/70 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            `;
            document.body.appendChild(installBtn);
            
            // Install button click
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User ${outcome} the install prompt`);
                    if (outcome === 'accepted') {
                        hideInstallPromotion();
                    }
                    deferredPrompt = null;
                }
            });
            
            // Dismiss button
            document.getElementById('dismissInstall').addEventListener('click', (e) => {
                e.stopPropagation();
                hideInstallPromotion();
                localStorage.setItem('pwa-install-dismissed', 'true');
                setTimeout(() => localStorage.removeItem('pwa-install-dismissed'), 7 * 24 * 60 * 60 * 1000); // 7 days
            });
        }

        function hideInstallPromotion() {
            const installBtn = document.getElementById('installBtn');
            if (installBtn) installBtn.remove();
        }

        function updatePWAStatus() {
            const event = new CustomEvent('pwaStatusChanged', { 
                detail: { isStandalone: isStandalone || window.matchMedia('(display-mode: standalone)').matches }
            });
            window.dispatchEvent(event);
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swUrl = './service-worker.js';
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found:', newWorker.state);
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New content available');
                                    showUpdateNotification();
                                }
                            });
                        });
                        
                        // Check for updates on page load
                        registration.update().catch(err => console.log('Update check failed:', err));
                    })
                    .catch(err => {
                        console.log('Service Worker registration failed:', err);
                        // Fallback: Create a simple service worker if it doesn't exist
                        if (err instanceof TypeError) {
                            createFallbackServiceWorker();
                        }
                    });
            });
        } else {
            console.log('Service Workers are not supported');
        }

        // Create fallback service worker
        function createFallbackServiceWorker() {
            const fallbackSW = `
                self.addEventListener('install', event => {
                    console.log('Fallback Service Worker installing');
                    self.skipWaiting();
                });

                self.addEventListener('activate', event => {
                    console.log('Fallback Service Worker activating');
                });

                self.addEventListener('fetch', event => {
                    // Network-first strategy for fallback
                    event.respondWith(fetch(event.request));
                });
            `;
            
            const blob = new Blob([fallbackSW], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(reg => console.log('Fallback Service Worker registered'))
                .catch(err => console.log('Fallback SW registration failed:', err));
        }

        // Update notification
        function showUpdateNotification() {
            // Remove existing notification
            const existing = document.getElementById('updateNotification');
            if (existing) existing.remove();
            
            const updateDiv = document.createElement('div');
            updateDiv.id = 'updateNotification';
            updateDiv.innerHTML = `
                <div class="fixed top-20 right-4 z-50 bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 rounded-xl shadow-2xl flex items-center justify-between gap-4 max-w-sm animate-slide-down">
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <div>
                            <p class="font-bold">Update Available</p>
                            <p class="text-sm opacity-90">Refresh for latest features</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="this.closest('#updateNotification').remove()" class="px-3 py-1 bg-white/20 rounded-lg text-sm">
                            Later
                        </button>
                        <button onclick="location.reload()" class="bg-white text-green-700 px-3 py-1 rounded-lg font-bold text-sm hover:bg-green-50">
                            Refresh
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(updateDiv);
            
            // Auto-remove after 30 seconds
            setTimeout(() => {
                if (updateDiv.parentNode) {
                    updateDiv.remove();
                }
            }, 30000);
        }

        // Network status detection
        let networkStatusTimeout;
        window.addEventListener('online', () => {
            clearTimeout(networkStatusTimeout);
            showNetworkStatus('You are back online', 'green');
            // Sync any pending data
            if (typeof window.syncPendingData === 'function') {
                window.syncPendingData();
            }
        });

        window.addEventListener('offline', () => {
            clearTimeout(networkStatusTimeout);
            showNetworkStatus('You are offline', 'red');
        });

        function showNetworkStatus(message, type) {
            // Remove existing status
            const existing = document.querySelector('.network-status');
            if (existing) existing.remove();
            
            const colors = {
                green: 'bg-green-500',
                red: 'bg-red-500',
                yellow: 'bg-yellow-500'
            };
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `network-status fixed top-4 left-1/2 transform -translate-x-1/2 z-50 ${colors[type]} text-white px-6 py-3 rounded-xl shadow-xl text-sm font-bold animate-slide-down flex items-center gap-2`;
            statusDiv.innerHTML = `
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${type === 'green' ? 'M5 13l4 4L19 7' : 'M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'}" />
                </svg>
                ${message}
            `;
            document.body.appendChild(statusDiv);
            
            networkStatusTimeout = setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.remove();
                }
            }, 3000);
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const types = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            const toast = document.createElement('div');
            toast.className = `fixed bottom-24 right-4 z-50 ${types[type]} text-white px-6 py-3 rounded-xl shadow-xl text-sm font-bold animate-slide-up`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // Initialize PWA check on load
        document.addEventListener('DOMContentLoaded', () => {
            // Check if already installed
            if (isStandalone) {
                console.log('App is running in standalone mode');
                document.body.classList.add('pwa-installed');
            }
            
            // Check for updates
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: 'CHECK_UPDATE' });
            }
            
            // Manual install button handler
            document.addEventListener('click', (e) => {
                if (e.target.closest('#manualInstallBtn')) {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                    } else if (!isStandalone) {
                        showInstallPromotion();
                    } else {
                        showToast('App is already installed!', 'info');
                    }
                }
            });
        });

        // Generate dynamic manifest
        function generateManifest() {
            const manifest = {
                "name": "OMR Master Pro",
                "short_name": "OMR Master",
                "description": "Professional OMR practice suite with advanced analytics",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#0f172a",
                "theme_color": "#2563eb",
                "orientation": "any",
                "scope": "./",
                "lang": "en",
                "categories": ["education", "productivity", "utilities"],
                "icons": [
                    {
                        "src": "icon.png",
                        "sizes": "72x72",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "96x96",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "128x128",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "144x144",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "152x152",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "192x192",
                        "type": "image/png",
                        "purpose": "any maskable"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "384x384",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon.png",
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "any maskable"
                    }
                ],
                "screenshots": [
                    {
                        "src": "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&h=600&fit=crop",
                        "sizes": "800x600",
                        "type": "image/jpeg",
                        "form_factor": "wide",
                        "label": "Dashboard view"
                    }
                ],
                "shortcuts": [
                    {
                        "name": "New Exam",
                        "short_name": "New",
                        "description": "Create a new exam configuration",
                        "url": "./?new-exam",
                        "icons": [{
                            "src": "icon.png",
                            "sizes": "96x96"
                        }]
                    },
                    {
                        "name": "Analytics",
                        "short_name": "Stats",
                        "description": "View your exam statistics",
                        "url": "./analytics.html",
                        "icons": [{
                            "src": "icon.png",
                            "sizes": "96x96"
                        }]
                    }
                ]
            };
            
            // Create manifest blob and URL
            const blob = new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Update manifest link
            const manifestLink = document.getElementById('manifestLink');
            if (manifestLink) {
                manifestLink.href = url;
            }
            
            return url;
        }

        // Generate manifest on load
        window.addEventListener('load', () => {
            generateManifest();
        });
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        bangla: ['Hind Siliguri', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'pop-in': 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'pulse-gentle': 'pulseGentle 2s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'slide-in-right': 'slideInRight 0.3s ease-out forwards',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'spin-slow': 'spin 3s linear infinite',
                        'wave': 'wave 2s linear infinite',
                        'gradient': 'gradient 3s ease infinite',
                        'shimmer': 'shimmer 2s infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        popIn: { '0%': { opacity: '0', transform: 'scale(0.9)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
                        pulseGentle: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.85' } },
                        float: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-10px)' } },
                        slideInRight: { '0%': { opacity: '0', transform: 'translateX(10px)' }, '100%': { opacity: '1', transform: 'translateX(0)' } },
                        bounceSubtle: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
                        slideDown: { '0%': { opacity: '0', transform: 'translateY(-20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        wave: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-100%)' } },
                        gradient: { '0%, 100%': { backgroundPosition: '0% 50%' }, '50%': { backgroundPosition: '100% 50%' } },
                        shimmer: { '0%': { backgroundPosition: '-1000px 0' }, '100%': { backgroundPosition: '1000px 0' } }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-attachment: fixed;
            background: radial-gradient(circle at top left, #f8fafc, #e2e8f0); 
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
        }
        .dark body {
            background: radial-gradient(circle at top left, #0f172a, #1e293b);
        }
        
        /* PWA specific styles */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            .nav-glass {
                padding-top: env(safe-area-inset-top);
                height: calc(80px + env(safe-area-inset-top));
            }
            .pwa-installed .install-btn {
                display: none !important;
            }
        }
        
        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        .dark .nav-glass {
            background: rgba(15, 23, 42, 0.85);
            border-bottom: 1px solid rgba(30, 41, 59, 0.8);
        }

        /* Range Slider Customization */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
            transition: all 0.2s ease;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.8);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 4px;
        }
        .dark input[type=range]::-webkit-slider-runnable-track {
            background: #475569;
        }

        /* Smart Input Styling */
        .smart-input-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .smart-input-label {
            position: absolute;
            top: -10px;
            left: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0 8px;
            background: white;
            color: #2563eb;
            z-index: 10;
            transition: all 0.2s ease;
            pointer-events: none;
        }
        .dark .smart-input-label {
            background: #0f172a;
            color: #60a5fa;
        }

        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Custom checkbox */
        .custom-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        .custom-checkbox:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }
        .custom-checkbox:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            font-weight: bold;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .dark .custom-checkbox {
            border-color: #475569;
        }
        .dark .custom-checkbox:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        /* Advanced Card */
        .advanced-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .advanced-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .dark .advanced-card:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Number Input Spinner */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            opacity: 1;
            height: 30px;
        }

        /* Enhanced input focus */
        .enhanced-input:focus {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            border-color: #2563eb;
        }
        .dark .enhanced-input:focus {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        /* PWA Install Button Animation */
        @keyframes pulse-install {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse-install {
            animation: pulse-install 2s infinite;
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(90deg, #2563eb, #7c3aed, #2563eb);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s linear infinite;
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        .dark .skeleton {
            background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 transition-colors duration-300 antialiased selection:bg-blue-500 selection:text-white">
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useRef } = React;

        // --- Translations Dictionary ---
        const translations = {
            en: {
                app_name: "OMR Master",
                pro: "PRO",
                dashboard: "Dashboard",
                active_session: "Active Session",
                analytics: "Analytics",
                about: "About",
                report: "Report Issues",
                guideline: "Guidelines",
                contact: "Contact",
                donation: "Donation",
                resume: "Resume Exam",
                exams_taken: "Exams Taken",
                avg_score: "Avg Score",
                last_active: "Last Active",
                new_config: "New Exam Configuration",
                config_sub: "Configure your exam parameters below",
                lbl_exam_name: "Exam Name",
                lbl_questions: "Total Questions",
                lbl_duration: "Duration (Minutes)",
                lbl_correct: "Correct (+)",
                lbl_wrong: "Wrong (-)",
                lbl_options: "Answer Options",
                lbl_pdf: "Question Paper URL",
                placeholder_exam: "Enter exam name (e.g., BCS 45th Preliminary Test)",
                placeholder_pdf: "https://drive.google.com/file/d/... or direct PDF link",
                btn_start: "Start Examination",
                btn_advanced: "Advanced Settings",
                footer_credit: "Designed & Developed by",
                footer_rights: "All Rights Reserved.",
                modal_about_title: "About OMR Master",
                modal_about_desc: "OMR Master Pro is an advanced self-testing tool designed to simulate real-world exam environments.",
                modal_contact_title: "Contact Us",
                modal_report_title: "Report an Issue",
                modal_guide_title: "Usage Guidelines",
                err_name_req: "Exam name is required",
                mode_standard: "Standard",
                mode_advanced: "Advanced",
                tips: "Tips",
                tip_1: "Use descriptive exam names for better tracking",
                tip_2: "Set realistic time limits matching actual exams",
                tip_3: "Add PDF link for split-screen practice",
                tip_4: "Adjust scoring based on exam pattern",
                preview: "Preview",
                total_time: "Total Time",
                scoring_system: "Scoring System",
                question_density: "Questions/Min",
                estimated_speed: "Sec/Question",
                auto_submit: "Auto Submit",
                shuffle_questions: "Shuffle Questions",
                show_timer: "Show Timer",
                enable_sound: "Enable Sound",
                dark_mode: "Dark Mode",
                quick_actions: "Quick Actions",
                enter_manually: "Enter manually",
                use_slider: "Use slider",
                decimal_support: "Supports 0.25, 0.33, 0.5 etc.",
                install_app: "Install App",
                app_installed: "App Installed",
                offline_mode: "Offline Mode",
                data_saved: "Data saved locally",
                pwa_features: "PWA Features",
                pwa_feature_1: "Works offline",
                pwa_feature_2: "Fast loading",
                pwa_feature_3: "Home screen icon",
                pwa_feature_4: "Push notifications",
                install_now: "Install Now",
                later: "Later",
                new_update: "New Update Available",
                refresh: "Refresh",
                network_online: "Back online",
                network_offline: "You are offline",
                cache_cleared: "Cache cleared",
                storage: "Storage",
                clear_data: "Clear Data",
                confirm_clear: "Are you sure?",
                yes: "Yes",
                no: "No",
                see_how_to_use: "See How to Use",
                view_details: "View Details",
                smart_config: "Smart Configuration",
                smart_tip: "Enter desired values for complete flexibility",
                any_questions: "Any Number of Questions",
                any_time: "Any Duration",
                input_validation: "Values will be automatically validated",
                unlimited_flexibility: "Unlimited Flexibility",
                recommended: "Recommended",
                set_custom: "Set Custom Values",
                exam_type: "Exam Type",
                exam_type_placeholder: "Select exam type or custom",
                exam_types: {
                    bcs: "BCS Preliminary",
                    medical: "Medical Admission",
                    hsc: "HSC/Bachelor",
                    bank: "Bank Recruitment",
                    university: "University Admission",
                    custom: "Custom Configuration"
                }
            },
            bn: {
                app_name: "ওএমআর মাস্টার",
                pro: "প্রো",
                dashboard: "ড্যাশবোর্ড",
                active_session: "চলমান সেশন",
                analytics: "বিশ্লেষণ",
                about: "আমাদের সম্পর্কে",
                report: "সমস্যা জানান",
                guideline: "নির্দেশাবলী",
                contact: "যোগাযোগ",
                donation: "অনুদান",
                resume: "পরীক্ষা শুরু করুন",
                exams_taken: "মোট পরীক্ষা",
                avg_score: "গড় স্কোর",
                last_active: "সর্বশেষ সক্রিয়",
                new_config: "নতুন পরীক্ষার কনফিগারেশন",
                config_sub: "নিচে আপনার পরীক্ষার প্যারামিটার সেট করুন",
                lbl_exam_name: "পরীক্ষার নাম",
                lbl_questions: "মোট প্রশ্ন",
                lbl_duration: "সময় (মিনিট)",
                lbl_correct: "সঠিক (+)",
                lbl_wrong: "ভুল (-)",
                lbl_options: "উত্তর অপশন",
                lbl_pdf: "প্রশ্নপত্রের লিংক",
                placeholder_exam: "পরীক্ষার নাম লিখুন (যেমন: বিসিএস ৪৫তম প্রিলিমিনারি)",
                placeholder_pdf: "https://drive.google.com/file/d/... অথবা সরাসরি পিডিএফ লিংক",
                btn_start: "পরীক্ষা শুরু করুন",
                btn_advanced: "এডভান্সড সেটিংস",
                footer_credit: "ডিজাইন ও ডেভেলপমেন্টে",
                footer_rights: "সর্বস্বত্ব সংরক্ষিত।",
                modal_about_title: "ওএমআর মাস্টার সম্পর্কে",
                modal_about_desc: "ওএমআর মাস্টার প্রো একটি উন্নত সেলফ-টেস্টিং টুল যা আপনাকে বাস্তব পরীক্ষার পরিবেশের অভিজ্ঞতা দেবে।",
                modal_contact_title: "যোগাযোগ করুন",
                modal_report_title: "সমস্যা রিপোর্ট করুন",
                modal_guide_title: "ব্যবহারের নিয়মাবলী",
                err_name_req: "পরীক্ষার নাম আবশ্যক",
                mode_standard: "স্ট্যান্ডার্ড",
                mode_advanced: "অ্যাডভান্সড",
                tips: "পরামর্শ",
                tip_1: "ভালো ট্র্যাকিংয়ের জন্য বর্ণনামূলক পরীক্ষার নাম ব্যবহার করুন",
                tip_2: "বাস্তব পরীক্ষার সাথে মিল রেখে সময় সীমা নির্ধারণ করুন",
                tip_3: "স্প্লিট-স্ক্রিন অনুশীলনের জন্য পিডিএফ লিংক যোগ করুন",
                tip_4: "পরীক্ষার প্যাটার্ন অনুযায়ী স্কোরিং সমন্বয় করুন",
                preview: "প্রিভিউ",
                total_time: "মোট সময়",
                scoring_system: "স্কোরিং সিস্টেম",
                question_density: "প্রশ্ন/মিনিট",
                estimated_speed: "সেকেন্ড/প্রশ্ন",
                auto_submit: "স্বয়ংক্রিয় জমা",
                shuffle_questions: "প্রশ্ন এলোমেলো",
                show_timer: "টাইমার দেখান",
                enable_sound: "শব্দ সক্রিয়",
                dark_mode: "ডার্ক মোড",
                quick_actions: "দ্রুত কাজ",
                enter_manually: "হাতে লিখুন",
                use_slider: "স্লাইডার ব্যবহার করুন",
                decimal_support: "০.২৫, ০.৩৩, ০.৫ ইত্যাদি সমর্থিত",
                install_app: "অ্যাপ ইন্সটল করুন",
                app_installed: "অ্যাপ ইন্সটল করা আছে",
                offline_mode: "অফলাইন মোড",
                data_saved: "ডাটা লোকালি সংরক্ষিত",
                pwa_features: "PWA ফিচারসমূহ",
                pwa_feature_1: "অফলাইনে কাজ করে",
                pwa_feature_2: "দ্রুত লোডিং",
                pwa_feature_3: "হোম স্ক্রিন আইকন",
                pwa_feature_4: "পুশ নোটিফিকেশন",
                install_now: "এখনই ইন্সটল করুন",
                later: "পরে",
                new_update: "নতুন আপডেট উপলব্ধ",
                refresh: "রিফ্রেশ",
                network_online: "অনলাইনে ফিরেছেন",
                network_offline: "আপনি অফলাইনে রয়েছেন",
                cache_cleared: "ক্যাশে মুছে ফেলা হয়েছে",
                storage: "স্টোরেজ",
                clear_data: "ডাটা ক্লিয়ার করুন",
                confirm_clear: "আপনি কি নিশ্চিত?",
                yes: "হ্যাঁ",
                no: "না",
                see_how_to_use: "ব্যবহার নির্দেশিকা দেখুন",
                view_details: "বিস্তারিত দেখুন",
                smart_config: "স্মার্ট কনফিগারেশন",
                smart_tip: "সম্পূর্ণ নমনীয়তার জন্য পছন্দের মান লিখুন",
                any_questions: "যেকোনো সংখ্যক প্রশ্ন",
                any_time: "যেকোনো সময়সীমা",
                input_validation: "মান স্বয়ংক্রিয়ভাবে যাচাই করা হবে",
                unlimited_flexibility: "সীমাহীন নমনীয়তা",
                recommended: "সুপারিশকৃত",
                set_custom: "কাস্টম মান সেট করুন",
                exam_type: "পরীক্ষার ধরন",
                exam_type_placeholder: "পরীক্ষার ধরন নির্বাচন করুন",
                exam_types: {
                    bcs: "বিসিএস প্রিলিমিনারি",
                    medical: "মেডিকেল ভর্তি",
                    hsc: "এইচএসসি/স্নাতক",
                    bank: "ব্যাংক নিয়োগ",
                    university: "বিশ্ববিদ্যালয় ভর্তি",
                    custom: "কাস্টম কনফিগারেশন"
                }
            }
        };

        // --- Icons (Lucide) ---
        const Icons = {
            Home: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Play: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            BarChart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Sun: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
            Moon: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
            Globe: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Info: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
            Flag: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>,
            Mail: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
            Book: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Heart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
            X: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            FileText: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Link: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Clock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            HelpCircle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
            ChevronRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            Calculator: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="12" y2="14"/></svg>,
            Hash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>,
            Download: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Wifi: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>,
            WifiOff: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>,
            Smartphone: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>,
            Refresh: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
            Database: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Edit: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Type: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>,
            Smartphone: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>,
            Infinity: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.74-8z"/></svg>
        };

        const AppContext = createContext();

        // Enhanced Modal with PWA features
        const Modal = ({ title, isOpen, onClose, children, size = 'lg' }) => {
            if (!isOpen) return null;
            
            const sizes = {
                sm: 'max-w-md',
                md: 'max-w-lg',
                lg: 'max-w-2xl',
                xl: 'max-w-4xl'
            };
            
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    <div className={`relative w-full ${sizes[size]} glass-panel rounded-2xl p-6 shadow-2xl animate-pop-in border border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/90`}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400">
                                {title}
                            </h3>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition">
                                <Icons.X />
                            </button>
                        </div>
                        <div className="text-slate-600 dark:text-slate-300 max-h-[60vh] overflow-y-auto pr-2">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Smart Input Component
        const SmartInput = ({ label, value, onChange, placeholder, type = "text", icon: Icon, required = false, name, min, max, step, className = "", disabled = false, error = null }) => {
            const [isFocused, setIsFocused] = useState(false);
            const hasValue = value !== '' && value !== undefined && value !== null;

            return (
                <div className={`smart-input-container ${className}`}>
                    <label className="smart-input-label">
                        {label}
                    </label>
                    <div className="relative">
                        {Icon && (
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                                <Icon />
                            </div>
                        )}
                        <input
                            type={type}
                            value={value}
                            onChange={onChange}
                            onFocus={() => setIsFocused(true)}
                            onBlur={() => setIsFocused(false)}
                            required={required}
                            name={name}
                            min={min}
                            max={max}
                            step={step}
                            disabled={disabled}
                            className={`w-full bg-white dark:bg-slate-800/50 border-2 ${isFocused ? 'border-blue-500 dark:border-blue-400' : 'border-slate-200 dark:border-slate-700'} rounded-xl ${Icon ? 'pl-10' : 'px-4'} py-3 text-slate-800 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none transition-all duration-200 enhanced-input ${error ? 'border-red-500' : ''}`}
                            placeholder={placeholder}
                        />
                    </div>
                    {error && (
                        <div className="text-red-500 text-sm mt-1 flex items-center gap-1">
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            {error}
                        </div>
                    )}
                </div>
            );
        };

        // Enhanced SmartNumberInput with validation and suggestions
        const SmartNumberInput = ({ label, value, onChange, min = 1, max = 10000, step = 1, unit = "", suggestions = [], name, className = "" }) => {
            const { lang } = useContext(AppContext);
            const [inputValue, setInputValue] = useState(value);
            const [showSuggestions, setShowSuggestions] = useState(false);
            
            useEffect(() => {
                setInputValue(value);
            }, [value]);
            
            const handleChange = (e) => {
                const val = parseInt(e.target.value) || min;
                setInputValue(val);
                onChange({ target: { name, value: val } });
            };
            
            const handleSuggestionClick = (suggestion) => {
                setInputValue(suggestion);
                onChange({ target: { name, value: suggestion } });
                setShowSuggestions(false);
            };
            
            const handleIncrement = () => {
                const newValue = Math.min(inputValue + step, max);
                setInputValue(newValue);
                onChange({ target: { name, value: newValue } });
            };
            
            const handleDecrement = () => {
                const newValue = Math.max(inputValue - step, min);
                setInputValue(newValue);
                onChange({ target: { name, value: newValue } });
            };

            return (
                <div className={`space-y-3 ${className}`}>
                    <label className="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center justify-between">
                        <span>{label}</span>
                        <span className="text-xs text-blue-600 dark:text-blue-400 font-normal">
                            {translations[lang].any_questions}
                        </span>
                    </label>
                    
                    <div className="flex gap-2">
                        <div className="relative flex-1">
                            <div className="flex border-2 border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden">
                                <button
                                    type="button"
                                    onClick={handleDecrement}
                                    className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                >
                                    −
                                </button>
                                <input
                                    type="number"
                                    name={name}
                                    value={inputValue}
                                    onChange={handleChange}
                                    min={min}
                                    max={max}
                                    step={step}
                                    className="w-full bg-white dark:bg-slate-800 px-4 py-3 text-slate-800 dark:text-white text-center focus:outline-none focus:border-blue-500"
                                />
                                <button
                                    type="button"
                                    onClick={handleIncrement}
                                    className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                >
                                    +
                                </button>
                            </div>
                            {unit && (
                                <div className="absolute right-12 top-1/2 transform -translate-y-1/2 text-slate-400">
                                    {unit}
                                </div>
                            )}
                        </div>
                        
                        <button
                            type="button"
                            onClick={() => setShowSuggestions(!showSuggestions)}
                            className="px-4 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl hover:bg-blue-100 dark:hover:bg-blue-900/50 transition flex items-center gap-2"
                        >
                            <Icons.Type className="w-4 h-4" />
                        </button>
                    </div>
                    
                    {suggestions.length > 0 && showSuggestions && (
                        <div className="grid grid-cols-3 gap-2 animate-fade-in">
                            {suggestions.map((suggestion, index) => (
                                <button
                                    key={index}
                                    type="button"
                                    onClick={() => handleSuggestionClick(suggestion)}
                                    className={`px-3 py-2 rounded-lg text-sm font-medium transition ${inputValue === suggestion ? 'bg-blue-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}
                                >
                                    {suggestion}
                                </button>
                            ))}
                        </div>
                    )}
                    
                    <div className="text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1">
                        <Icons.Infinity className="w-3 h-3" />
                        {translations[lang].input_validation}
                    </div>
                </div>
            );
        };

        // Enhanced Duration Input with smart conversion
        const SmartDurationInput = ({ label, value, onChange, name, className = "" }) => {
            const { lang } = useContext(AppContext);
            const [inputMode, setInputMode] = useState('minutes'); // 'minutes' or 'hours'
            const [displayValue, setDisplayValue] = useState(value);
            
            useEffect(() => {
                setDisplayValue(value);
            }, [value]);
            
            const handleMinutesChange = (e) => {
                const minutes = parseInt(e.target.value) || 1;
                setDisplayValue(minutes);
                onChange({ target: { name, value: minutes } });
            };
            
            const handleHoursChange = (e) => {
                const hours = parseFloat(e.target.value) || 0.5;
                const minutes = Math.round(hours * 60);
                setDisplayValue(minutes);
                onChange({ target: { name, value: minutes } });
            };
            
            const getHoursValue = () => {
                return (displayValue / 60).toFixed(1);
            };

            const durationSuggestions = {
                minutes: [5, 10, 15, 30, 45, 60, 90, 120, 180, 240, 300],
                hours: [0.5, 1, 1.5, 2, 2.5, 3, 4, 5, 6, 8, 10]
            };

            return (
                <div className={`space-y-4 ${className}`}>
                    <div className="flex justify-between items-center">
                        <label className="text-sm font-semibold text-slate-700 dark:text-slate-300">
                            {label}
                        </label>
                        <div className="flex gap-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-lg">
                            <button
                                type="button"
                                onClick={() => setInputMode('minutes')}
                                className={`px-3 py-1 rounded text-sm font-medium transition ${inputMode === 'minutes' ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-slate-600 dark:text-slate-400'}`}
                            >
                                Minutes
                            </button>
                            <button
                                type="button"
                                onClick={() => setInputMode('hours')}
                                className={`px-3 py-1 rounded text-sm font-medium transition ${inputMode === 'hours' ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm' : 'text-slate-600 dark:text-slate-400'}`}
                            >
                                Hours
                            </button>
                        </div>
                    </div>
                    
                    {inputMode === 'minutes' ? (
                        <div className="space-y-3">
                            <div className="flex gap-2">
                                <div className="relative flex-1">
                                    <div className="flex border-2 border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden">
                                        <button
                                            type="button"
                                            onClick={() => handleMinutesChange({ target: { value: Math.max(displayValue - 5, 1) } })}
                                            className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                        >
                                            −5
                                        </button>
                                        <input
                                            type="number"
                                            name={name}
                                            value={displayValue}
                                            onChange={handleMinutesChange}
                                            min="1"
                                            max="1440"
                                            step="1"
                                            className="w-full bg-white dark:bg-slate-800 px-4 py-3 text-slate-800 dark:text-white text-center focus:outline-none focus:border-blue-500"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => handleMinutesChange({ target: { value: Math.min(displayValue + 5, 1440) } })}
                                            className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                        >
                                            +5
                                        </button>
                                    </div>
                                    <div className="absolute right-12 top-1/2 transform -translate-y-1/2 text-slate-400">
                                        min
                                    </div>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-4 gap-2">
                                {durationSuggestions.minutes.map((minutes) => (
                                    <button
                                        key={minutes}
                                        type="button"
                                        onClick={() => handleMinutesChange({ target: { value: minutes } })}
                                        className={`px-2 py-1.5 rounded-lg text-xs font-medium transition ${displayValue === minutes ? 'bg-blue-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}
                                    >
                                        {minutes}m
                                    </button>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            <div className="flex gap-2">
                                <div className="relative flex-1">
                                    <div className="flex border-2 border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden">
                                        <button
                                            type="button"
                                            onClick={() => handleHoursChange({ target: { value: Math.max(parseFloat(getHoursValue()) - 0.5, 0.1).toFixed(1) } })}
                                            className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                        >
                                            −0.5
                                        </button>
                                        <input
                                            type="number"
                                            value={getHoursValue()}
                                            onChange={handleHoursChange}
                                            min="0.1"
                                            max="24"
                                            step="0.1"
                                            className="w-full bg-white dark:bg-slate-800 px-4 py-3 text-slate-800 dark:text-white text-center focus:outline-none focus:border-blue-500"
                                        />
                                        <button
                                            type="button"
                                            onClick={() => handleHoursChange({ target: { value: Math.min(parseFloat(getHoursValue()) + 0.5, 24).toFixed(1) } })}
                                            className="px-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                        >
                                            +0.5
                                        </button>
                                    </div>
                                    <div className="absolute right-12 top-1/2 transform -translate-y-1/2 text-slate-400">
                                        hours
                                    </div>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-4 gap-2">
                                {durationSuggestions.hours.map((hours) => (
                                    <button
                                        key={hours}
                                        type="button"
                                        onClick={() => handleHoursChange({ target: { value: hours } })}
                                        className={`px-2 py-1.5 rounded-lg text-xs font-medium transition ${parseFloat(getHoursValue()).toFixed(1) === hours.toFixed(1) ? 'bg-blue-500 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}
                                    >
                                        {hours}h
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    <div className="text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1">
                        <Icons.Clock className="w-3 h-3" />
                        {displayValue} minutes • {(displayValue / 60).toFixed(1)} hours
                    </div>
                </div>
            );
        };

        // Enhanced Scoring Input with decimal support
        const ScoringInput = ({ label, value, onChange, name, type = "positive", placeholder, step = 0.01 }) => {
            const { lang } = useContext(AppContext);
            const [quickValues, setQuickValues] = useState(type === 'positive' ? [1, 2, 3] : [0, 0.25, 0.5, 0.33, 1]);
            
            const handleQuickSelect = (quickValue) => {
                onChange({ target: { name, value: quickValue } });
            };

            const handleInputChange = (e) => {
                let newValue = parseFloat(e.target.value);
                if (isNaN(newValue)) newValue = 0;
                if (newValue < 0) newValue = 0;
                onChange({ target: { name, value: newValue } });
            };

            return (
                <div className="space-y-3">
                    <label className="text-sm font-semibold text-slate-700 dark:text-slate-300 block">
                        {label}
                        {type === 'negative' && (
                            <span className="text-xs text-slate-500 dark:text-slate-400 ml-2">
                                ({translations[lang].decimal_support})
                            </span>
                        )}
                    </label>
                    
                    <div className="relative">
                        <div className="flex items-center">
                            <span className={`px-4 py-3 rounded-l-xl font-bold ${type === 'positive' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}`}>
                                {type === 'positive' ? '+' : '-'}
                            </span>
                            <input
                                type="number"
                                name={name}
                                value={value}
                                onChange={handleInputChange}
                                step={step}
                                min="0"
                                className="w-full bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 border-l-0 rounded-r-xl px-4 py-3 text-slate-800 dark:text-white focus:outline-none focus:border-blue-500 enhanced-input"
                                placeholder={placeholder}
                            />
                        </div>
                    </div>
                    
                    {/* Quick Selection Buttons */}
                    <div className="flex flex-wrap gap-2">
                        {quickValues.map((quickValue, index) => (
                            <button
                                key={index}
                                type="button"
                                onClick={() => handleQuickSelect(quickValue)}
                                className={`px-3 py-1.5 rounded-lg text-sm font-medium transition ${value == quickValue ? (type === 'positive' ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-700' : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-300 dark:border-red-700') : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}
                            >
                                {type === 'positive' ? '+' : '-'}{quickValue}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Exam Type Selector Component
        const ExamTypeSelector = ({ value, onChange, className = "" }) => {
            const { lang } = useContext(AppContext);
            const examTypes = [
                { id: 'bcs', name: translations[lang].exam_types.bcs, questions: 200, duration: 120, positive: 1, negative: 0.25, options: 4 },
                { id: 'medical', name: translations[lang].exam_types.medical, questions: 100, duration: 60, positive: 1, negative: 0.33, options: 4 },
                { id: 'hsc', name: translations[lang].exam_types.hsc, questions: 25, duration: 25, positive: 1, negative: 0, options: 4 },
                { id: 'bank', name: translations[lang].exam_types.bank, questions: 100, duration: 80, positive: 1, negative: 0.5, options: 5 },
                { id: 'university', name: translations[lang].exam_types.university, questions: 50, duration: 40, positive: 1, negative: 0.2, options: 4 },
                { id: 'custom', name: translations[lang].exam_types.custom, questions: 10, duration: 10, positive: 1, negative: 0.25, options: 4 }
            ];

            const handleExamTypeSelect = (examType) => {
                if (examType.id === 'custom') {
                    // For custom, just set the type but keep existing values
                    onChange({ target: { value: examType.id } });
                } else {
                    // For predefined types, apply the configuration
                    onChange({ target: { value: examType.id } });
                    // Dispatch custom event to update the form
                    const event = new CustomEvent('applyExamType', { detail: examType });
                    window.dispatchEvent(event);
                }
            };

            return (
                <div className={`space-y-3 ${className}`}>
                    <label className="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center justify-between">
                        <span>{translations[lang].exam_type}</span>
                        <span className="text-xs text-blue-600 dark:text-blue-400">
                            {value === 'custom' ? translations[lang].unlimited_flexibility : translations[lang].recommended}
                        </span>
                    </label>
                    
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                        {examTypes.map((examType) => (
                            <button
                                key={examType.id}
                                type="button"
                                onClick={() => handleExamTypeSelect(examType)}
                                className={`p-3 rounded-xl border-2 transition-all ${value === examType.id ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-600'}`}
                            >
                                <div className="font-medium text-slate-800 dark:text-white text-sm">{examType.name}</div>
                                {examType.id !== 'custom' && (
                                    <div className="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                        {examType.questions}Q • {examType.duration}m
                                    </div>
                                )}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // PWA Settings Modal
        const PWASettingsModal = ({ isOpen, onClose }) => {
            const { lang } = useContext(AppContext);
            const t = (k) => translations[lang][k];
            const [storageInfo, setStorageInfo] = useState({});
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            
            useEffect(() => {
                if ('storage' in navigator && 'estimate' in navigator.storage) {
                    navigator.storage.estimate().then(estimate => {
                        setStorageInfo({
                            usage: (estimate.usage / (1024 * 1024)).toFixed(2),
                            quota: (estimate.quota / (1024 * 1024)).toFixed(2)
                        });
                    });
                }
                
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.getRegistrations().then(regs => {
                        setStorageInfo(prev => ({...prev, swCount: regs.length}));
                    });
                }
            }, [isOpen]);
            
            const clearCache = async () => {
                try {
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(cacheNames.map(name => caches.delete(name)));
                    }
                    
                    if ('serviceWorker' in navigator) {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        await Promise.all(registrations.map(reg => reg.unregister()));
                    }
                    
                    localStorage.removeItem('omr_history');
                    localStorage.removeItem('omr_current_session');
                    
                    window.dispatchEvent(new CustomEvent('cacheCleared'));
                    setShowClearConfirm(false);
                    setTimeout(() => window.location.reload(), 1000);
                } catch (err) {
                    console.error('Failed to clear cache:', err);
                }
            };
            
            const updateApp = () => {
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
                window.location.reload();
            };
            
            return (
                <Modal
                    title="PWA Settings"
                    isOpen={isOpen}
                    onClose={onClose}
                    size="md"
                >
                    <div className="space-y-6">
                        <div className="space-y-4">
                            <h4 className="font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                                <Icons.Database /> {t('storage')}
                            </h4>
                            {storageInfo.usage && (
                                <div className="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm text-slate-600 dark:text-slate-400">Storage Used</span>
                                        <span className="font-bold">{storageInfo.usage} MB / {storageInfo.quota} MB</span>
                                    </div>
                                    <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2">
                                        <div 
                                            className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-500" 
                                            style={{ width: `${(storageInfo.usage / storageInfo.quota) * 100}%` }}
                                        ></div>
                                    </div>
                                </div>
                            )}
                            
                            <button
                                onClick={() => setShowClearConfirm(true)}
                                className="w-full py-3 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-xl font-bold hover:from-red-600 hover:to-rose-600 transition flex items-center justify-center gap-2"
                            >
                                <Icons.Refresh /> {t('clear_data')}
                            </button>
                            
                            {showClearConfirm && (
                                <div className="fixed inset-0 z-[101] flex items-center justify-center p-4">
                                    <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={() => setShowClearConfirm(false)}></div>
                                    <div className="relative glass-panel rounded-2xl p-6 shadow-2xl animate-pop-in max-w-sm w-full">
                                        <h4 className="text-lg font-bold text-slate-800 dark:text-white mb-4">{t('confirm_clear')}</h4>
                                        <p className="text-slate-600 dark:text-slate-400 mb-6">
                                            This will clear all cached data and restart the app.
                                        </p>
                                        <div className="flex gap-3">
                                            <button
                                                onClick={() => setShowClearConfirm(false)}
                                                className="flex-1 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg font-bold"
                                            >
                                                {t('no')}
                                            </button>
                                            <button
                                                onClick={clearCache}
                                                className="flex-1 py-2 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-lg font-bold"
                                            >
                                                {t('yes')}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="space-y-4">
                            <h4 className="font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                                <Icons.Shield /> Service Worker
                            </h4>
                            <div className="space-y-2">
                                <div className="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                                    <span className="text-sm text-slate-600 dark:text-slate-400">Status</span>
                                    <span className="font-bold text-green-600 dark:text-green-400">
                                        {navigator.serviceWorker ? 'Active' : 'Not Supported'}
                                    </span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                                    <span className="text-sm text-slate-600 dark:text-slate-400">Registrations</span>
                                    <span className="font-bold">{storageInfo.swCount || 0}</span>
                                </div>
                            </div>
                            
                            <button
                                onClick={updateApp}
                                className="w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl font-bold hover:from-blue-600 hover:to-indigo-600 transition flex items-center justify-center gap-2"
                            >
                                <Icons.Refresh /> Check for Updates
                            </button>
                        </div>
                        
                        <div className="space-y-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                            <h4 className="font-semibold text-slate-800 dark:text-white">PWA Features</h4>
                            <div className="grid grid-cols-2 gap-3">
                                <div className="p-3 bg-gradient-to-br from-blue-500/10 to-blue-600/10 rounded-xl text-center">
                                    <div className="text-blue-600 dark:text-blue-400 font-bold">Offline</div>
                                    <div className="text-xs text-slate-600 dark:text-slate-400">Works offline</div>
                                </div>
                                <div className="p-3 bg-gradient-to-br from-green-500/10 to-green-600/10 rounded-xl text-center">
                                    <div className="text-green-600 dark:text-green-400 font-bold">Fast</div>
                                    <div className="text-xs text-slate-600 dark:text-slate-400">Instant loading</div>
                                </div>
                                <div className="p-3 bg-gradient-to-br from-purple-500/10 to-purple-600/10 rounded-xl text-center">
                                    <div className="text-purple-600 dark:text-purple-400 font-bold">Installable</div>
                                    <div className="text-xs text-slate-600 dark:text-slate-400">Add to home screen</div>
                                </div>
                                <div className="p-3 bg-gradient-to-br from-amber-500/10 to-amber-600/10 rounded-xl text-center">
                                    <div className="text-amber-600 dark:text-amber-400 font-bold">Secure</div>
                                    <div className="text-xs text-slate-600 dark:text-slate-400">HTTPS only</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </Modal>
            );
        };

        // PWA Status Component
        const PWAStatus = () => {
            const [isStandalone, setIsStandalone] = useState(false);
            const [isOnline, setIsOnline] = useState(true);
            const [showPWAModal, setShowPWAModal] = useState(false);
            const { lang } = useContext(AppContext);
            const t = (k) => translations[lang][k];

            useEffect(() => {
                // Check if app is running in standalone mode
                const checkStandalone = () => {
                    const standalone = window.matchMedia('(display-mode: standalone)').matches || 
                                    window.navigator.standalone || 
                                    document.referrer.includes('android-app://');
                    setIsStandalone(standalone);
                };
                
                checkStandalone();
                
                // Check online status
                setIsOnline(navigator.onLine);
                
                // Listen for events
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                const handlePWAStatus = (e) => setIsStandalone(e.detail.isStandalone);
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                window.addEventListener('pwaStatusChanged', handlePWAStatus);
                
                // Check for updates periodically
                const updateInterval = setInterval(() => {
                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({ type: 'CHECK_UPDATE' });
                    }
                }, 5 * 60 * 1000); // Every 5 minutes
                
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                    window.removeEventListener('pwaStatusChanged', handlePWAStatus);
                    clearInterval(updateInterval);
                };
            }, []);

            if (!isStandalone && isOnline) return null;

            return (
                <div className="fixed bottom-20 left-4 z-40 flex flex-col gap-2">
                    {isStandalone && (
                        <div 
                            className="flex items-center gap-2 bg-green-500 text-white px-3 py-2 rounded-xl shadow-lg text-sm font-bold animate-slide-in-right cursor-pointer hover:scale-105 transition-transform"
                            onClick={() => setShowPWAModal(true)}
                        >
                            <Icons.Smartphone className="w-4 h-4" />
                            <span>{t('app_installed')}</span>
                        </div>
                    )}
                    {!isOnline && (
                        <div className="flex items-center gap-2 bg-yellow-500 text-white px-3 py-2 rounded-xl shadow-lg text-sm font-bold animate-slide-in-right">
                            <Icons.WifiOff className="w-4 h-4" />
                            <span>{t('offline_mode')}</span>
                        </div>
                    )}
                    
                    {showPWAModal && (
                        <PWASettingsModal isOpen={showPWAModal} onClose={() => setShowPWAModal(false)} />
                    )}
                </div>
            );
        };

        // Quick Actions Component
        const QuickActions = () => {
            const { lang } = useContext(AppContext);
            const t = (k) => translations[lang][k];
            const [showActions, setShowActions] = useState(false);
            const [showPWAModal, setShowPWAModal] = useState(false);

            const quickActions = [
                { name: 'Clear Session', icon: Icons.Refresh, action: () => {
                    localStorage.removeItem('omr_current_session');
                    window.location.reload();
                }},
                { name: 'View Analytics', icon: Icons.BarChart, action: () => window.location.href = 'analytics.html'},
                { name: 'Guidelines', icon: Icons.Book, action: () => window.location.href = 'guideline.html'},
                { name: 'PWA Settings', icon: Icons.Settings, action: () => setShowPWAModal(true)}
            ];

            return (
                <div className="fixed bottom-4 left-4 z-40">
                    <button
                        onClick={() => setShowActions(!showActions)}
                        className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-3 rounded-xl shadow-xl hover:shadow-2xl transition-all hover:scale-105"
                    >
                        <Icons.Settings className="w-6 h-6" />
                    </button>
                    
                    {showActions && (
                        <div className="absolute bottom-16 left-0 bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-4 min-w-[200px] animate-pop-in">
                            <h4 className="font-bold text-slate-800 dark:text-white mb-3">{t('quick_actions')}</h4>
                            <div className="space-y-2">
                                {quickActions.map((action, index) => (
                                    <button
                                        key={index}
                                        onClick={() => {
                                            action.action();
                                            setShowActions(false);
                                        }}
                                        className="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-300 flex items-center gap-2"
                                    >
                                        <action.icon className="w-4 h-4" />
                                        {action.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {showPWAModal && (
                        <PWASettingsModal isOpen={showPWAModal} onClose={() => setShowPWAModal(false)} />
                    )}
                </div>
            );
        };

        const Navbar = ({ activePage }) => {
            const { lang, setLang, darkMode, setDarkMode } = useContext(AppContext);
            const [isOpen, setIsOpen] = useState(false);
            const [sessionActive, setSessionActive] = useState(false);
            const [isPWA, setIsPWA] = useState(false);
            const t = (k) => translations[lang][k];

            useEffect(() => {
                const session = localStorage.getItem('omr_current_session');
                if (session) setSessionActive(true);
                
                // Check if PWA
                const checkPWA = window.matchMedia('(display-mode: standalone)').matches;
                setIsPWA(checkPWA);
                
                // Listen for PWA status changes
                const handlePWAStatus = (e) => setIsPWA(e.detail.isStandalone);
                window.addEventListener('pwaStatusChanged', handlePWAStatus);
                
                return () => window.removeEventListener('pwaStatusChanged', handlePWAStatus);
            }, []);

            const toggleTheme = () => {
                const newDarkMode = !darkMode;
                setDarkMode(newDarkMode);
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', newDarkMode ? 'dark' : 'light');
            };

            const toggleLang = () => {
                const newLang = lang === 'en' ? 'bn' : 'en';
                setLang(newLang);
                localStorage.setItem('lang', newLang);
            };

            // Main navigation links
            const links = [
                { name: t('dashboard'), href: 'index.html', icon: Icons.Home, active: activePage === 'home' },
                { name: t('active_session'), href: 'exam.html', icon: Icons.Play, active: activePage === 'exam', hidden: !sessionActive },
                { name: t('analytics'), href: 'analytics.html', icon: Icons.BarChart, active: activePage === 'analytics' },
            ];

            // Secondary navigation links
            const secondaryLinks = [
                { name: t('about'), icon: Icons.Info, href: 'about.html' },
                { name: t('guideline'), icon: Icons.Book, href: 'guideline.html' },
                { name: t('report'), icon: Icons.Flag, href: 'report.html' },
                { name: t('contact'), icon: Icons.Mail, href: 'contact.html' },
                { name: t('donation'), icon: Icons.Heart, href: 'donate.html' },
            ];

            return (
                <nav className="fixed top-0 inset-x-0 z-50 nav-glass transition-all duration-300 shadow-sm pwa-padding">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-20">
                            <div className="flex items-center gap-3 cursor-pointer group" onClick={() => window.location.href='index.html'}>
                                <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-500/20 transition-transform group-hover:scale-105 group-hover:rotate-3">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4"/></svg>
                                </div>
                                <div className={lang === 'bn' ? 'font-bangla' : ''}>
                                    <h1 className="text-xl font-bold text-slate-800 dark:text-white tracking-tight leading-none">{t('app_name')}</h1>
                                    <div className="flex items-center gap-1">
                                        <span className="text-[10px] font-bold tracking-widest text-blue-600 dark:text-blue-400 uppercase">{t('pro')}</span>
                                        {isPWA && (
                                            <span className="text-[8px] font-bold tracking-widest text-green-600 dark:text-green-400 uppercase">PWA</span>
                                        )}
                                    </div>
                                </div>
                            </div>
                            <div className="hidden lg:flex items-center gap-2">
                                <div className="flex items-center gap-1 mr-4 bg-slate-100 dark:bg-slate-800 p-1.5 rounded-full border border-slate-200 dark:border-slate-700">
                                    {links.map(link => !link.hidden && (
                                        <a key={link.name} href={link.href} className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 ${link.active ? 'bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-300 shadow-sm' : 'text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200'}`}>
                                            <link.icon /> <span className={lang === 'bn' ? 'font-bangla' : ''}>{link.name}</span>
                                        </a>
                                    ))}
                                </div>
                                {secondaryLinks.map((item, idx) => (
                                    <a key={idx} href={item.href} title={item.name} className="p-2.5 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors">
                                        <item.icon />
                                    </a>
                                ))}
                                <div className="h-6 w-px bg-slate-200 dark:bg-slate-700 mx-2"></div>
                                <button onClick={toggleLang} className="flex items-center gap-2 px-3 py-2 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 font-bold text-sm hover:scale-105 transition-transform">
                                    <Icons.Globe /> {lang === 'en' ? 'BN' : 'EN'}
                                </button>
                                <button onClick={toggleTheme} className="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:rotate-12 transition-transform">
                                    {darkMode ? <Icons.Sun /> : <Icons.Moon />}
                                </button>
                            </div>
                            <div className="lg:hidden flex items-center gap-3">
                                <button onClick={toggleLang} className="text-sm font-bold text-indigo-600 dark:text-indigo-400">{lang === 'en' ? 'BN' : 'EN'}</button>
                                <button onClick={toggleTheme} className="text-slate-600 dark:text-slate-300">{darkMode ? <Icons.Sun /> : <Icons.Moon />}</button>
                                <button onClick={() => setIsOpen(!isOpen)} className="p-2 text-slate-500 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={isOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16"} /></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    {isOpen && (
                        <div className="lg:hidden border-t border-slate-100 dark:border-slate-800 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl absolute w-full shadow-xl">
                            <div className="p-4 space-y-2">
                                {links.map(link => !link.hidden && (
                                    <a key={link.name} href={link.href} className={`flex items-center gap-3 px-4 py-3 rounded-xl text-base font-medium ${link.active ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300' : 'text-slate-600 dark:text-slate-400'}`}>
                                        <link.icon /> <span className={lang === 'bn' ? 'font-bangla' : ''}>{link.name}</span>
                                    </a>
                                ))}
                                <hr className="border-slate-100 dark:border-slate-800 my-2" />
                                {secondaryLinks.map((item, idx) => (
                                    <a key={idx} href={item.href} className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-base font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800">
                                        <item.icon /> <span className={lang === 'bn' ? 'font-bangla' : ''}>{item.name}</span>
                                    </a>
                                ))}
                            </div>
                        </div>
                    )}
                </nav>
            );
        };

        const Footer = () => {
            const { lang } = useContext(AppContext);
            const t = (k) => translations[lang][k];
            const currentYear = new Date().getFullYear();
            const [isOnline, setIsOnline] = useState(true);
            const [showPWAModal, setShowPWAModal] = useState(false);

            useEffect(() => {
                setIsOnline(navigator.onLine);
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            const handleInstallClick = () => {
                if (window.deferredPrompt) {
                    window.deferredPrompt.prompt();
                } else {
                    // Show manual install instructions
                    setShowPWAModal(true);
                }
            };

            return (
                <>
                    <footer className="mt-12 border-t border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 backdrop-blur-lg">
                        <div className="max-w-7xl mx-auto px-4 py-8">
                            <div className="flex flex-col lg:flex-row justify-between items-center gap-6">
                                <div className="flex items-center gap-3">
                                    <div className="flex items-center gap-2 text-slate-800 dark:text-slate-200 font-bold text-lg">
                                        <span className="w-8 h-8 bg-blue-600 text-white flex items-center justify-center rounded-lg">UR</span>
                                        Urfa Hasan Fattah & Rifat
                                    </div>
                                    <div className="flex items-center gap-2">
                                        {isOnline ? (
                                            <Icons.Wifi className="w-4 h-4 text-green-500" />
                                        ) : (
                                            <Icons.WifiOff className="w-4 h-4 text-yellow-500" />
                                        )}
                                        <span className="text-xs text-slate-500 dark:text-slate-400">
                                            {isOnline ? 'Online' : 'Offline'}
                                        </span>
                                    </div>
                                </div>
                                
                                <div className="text-center">
                                    <p className={`text-sm text-slate-500 dark:text-slate-400 ${lang === 'bn' ? 'font-bangla' : ''}`}>
                                        {t('footer_credit')} <span className="font-semibold text-slate-700 dark:text-slate-300">Urfa Hasan Fattah & Rifatuzzaman Rifat</span>. &copy; {currentYear} {t('footer_rights')}
                                    </p>
                                    <p className="text-xs text-slate-400 dark:text-slate-500 mt-1">
                                        {t('data_saved')} • PWA Enabled
                                    </p>
                                </div>
                                
                                <div className="flex flex-col gap-3">
                                    <a 
                                        href="donate.html" 
                                        className="inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-bold rounded-xl shadow-lg shadow-pink-500/20 hover:shadow-xl hover:shadow-pink-500/30 transition-all duration-300 hover:scale-105"
                                    >
                                        <Icons.Heart className="w-5 h-5" />
                                        <span className={lang === 'bn' ? 'font-bangla' : ''}>{t('donation')}</span>
                                    </a>
                                    
                                    {/* Install PWA Button */}
                                    <button 
                                        id="manualInstallBtn"
                                        onClick={handleInstallClick}
                                        className="inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-blue-500/20 hover:shadow-xl hover:shadow-blue-500/30 transition-all duration-300 hover:scale-105 text-sm pulse-install"
                                    >
                                        <Icons.Download className="w-4 h-4" />
                                        <span>{t('install_app')}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </footer>
                    
                    {showPWAModal && (
                        <PWASettingsModal isOpen={showPWAModal} onClose={() => setShowPWAModal(false)} />
                    )}
                </>
            );
        };

        const Home = () => {
            const { lang, darkMode } = useContext(AppContext);
            const t = (k) => translations[lang][k];
            
            const [resume, setResume] = useState(null);
            const [showAdvanced, setShowAdvanced] = useState(false);
            const [showPWAModal, setShowPWAModal] = useState(false);
            const [isStandalone, setIsStandalone] = useState(false);
            const [configMode, setConfigMode] = useState('standard');
            const [examType, setExamType] = useState('custom');
            const [errors, setErrors] = useState({});
            
            // Enhanced Config with unlimited flexibility
            const initialConfig = {
                examName: '', 
                questionCount: 10, 
                optionsCount: 4, 
                duration: 5,
                positiveMarks: 1, 
                negativeMarks: 0.25, 
                pdfLink: '',
                shuffleQuestions: true,
                showTimer: true,
                autoSubmit: true,
                enableSound: false,
                darkMode: false
            };
            
            const [config, setConfig] = useState(initialConfig);

            const [stats, setStats] = useState({ total: 0, avgScore: 0, lastExam: 'Never' });

            // Calculate derived metrics
            const calculatedMetrics = {
                timePerQuestion: config.duration && config.questionCount ? (config.duration * 60 / config.questionCount).toFixed(1) : 0,
                maxScore: config.questionCount * config.positiveMarks,
                passingScore: Math.ceil(config.questionCount * 0.33 * config.positiveMarks),
                questionDensity: config.duration ? (config.questionCount / config.duration).toFixed(1) : 0,
                negativeImpact: (config.negativeMarks / config.positiveMarks).toFixed(2),
                totalTimeFormatted: config.duration >= 60 ? 
                    `${Math.floor(config.duration / 60)}h ${config.duration % 60}m` : 
                    `${config.duration}m`
            };

            useEffect(() => {
                // Check session
                const session = JSON.parse(localStorage.getItem('omr_current_session'));
                if (session && session.timeLeft > 0) setResume(session);

                // Load stats
                const history = JSON.parse(localStorage.getItem('omr_history') || '[]');
                if (history.length > 0) {
                    const totalScore = history.reduce((acc, curr) => acc + parseFloat(curr.score), 0);
                    setStats({
                        total: history.length,
                        avgScore: (totalScore / history.length).toFixed(1),
                        lastExam: new Date(history[history.length - 1].date).toLocaleDateString()
                    });
                }

                // Check PWA status
                const checkPWA = window.matchMedia('(display-mode: standalone)').matches;
                setIsStandalone(checkPWA);
                
                // Show PWA modal if not installed
                if (!checkPWA && !localStorage.getItem('pwa_prompt_shown')) {
                    setTimeout(() => {
                        setShowPWAModal(true);
                        localStorage.setItem('pwa_prompt_shown', 'true');
                    }, 3000);
                }

                // Set dark mode from context
                setConfig(prev => ({ ...prev, darkMode }));

                // Listen for exam type application
                const handleApplyExamType = (e) => {
                    const examType = e.detail;
                    setConfig(prev => ({
                        ...prev,
                        questionCount: examType.questions,
                        duration: examType.duration,
                        positiveMarks: examType.positive,
                        negativeMarks: examType.negative,
                        optionsCount: examType.options
                    }));
                };
                
                window.addEventListener('applyExamType', handleApplyExamType);
                
                return () => window.removeEventListener('applyExamType', handleApplyExamType);
            }, []);

            // Enhanced validation
            const validateField = (name, value) => {
                const newErrors = { ...errors };
                
                switch (name) {
                    case 'examName':
                        if (!value.trim()) {
                            newErrors.examName = t('err_name_req');
                        } else if (value.length > 100) {
                            newErrors.examName = 'Exam name too long (max 100 characters)';
                        } else {
                            delete newErrors.examName;
                        }
                        break;
                        
                    case 'questionCount':
                        if (value < 1) {
                            newErrors.questionCount = 'Minimum 1 question required';
                        } else if (value > 10000) {
                            newErrors.questionCount = 'Maximum 10000 questions allowed';
                        } else {
                            delete newErrors.questionCount;
                        }
                        break;
                        
                    case 'duration':
                        if (value < 1) {
                            newErrors.duration = 'Minimum 1 minute required';
                        } else if (value > 1440) {
                            newErrors.duration = 'Maximum 24 hours (1440 minutes) allowed';
                        } else {
                            delete newErrors.duration;
                        }
                        break;
                        
                    case 'positiveMarks':
                        if (value < 0) {
                            newErrors.positiveMarks = 'Positive marks cannot be negative';
                        } else if (value > 100) {
                            newErrors.positiveMarks = 'Maximum 100 marks per question';
                        } else {
                            delete newErrors.positiveMarks;
                        }
                        break;
                        
                    case 'negativeMarks':
                        if (value < 0) {
                            newErrors.negativeMarks = 'Negative marks cannot be negative';
                        } else if (value > 100) {
                            newErrors.negativeMarks = 'Maximum 100 marks deduction per question';
                        } else {
                            delete newErrors.negativeMarks;
                        }
                        break;
                }
                
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleChange = (e) => {
                const { name, value, type } = e.target;
                let processedValue = value;
                
                // Handle number inputs
                if (name === 'questionCount' || name === 'duration' || name === 'optionsCount') {
                    processedValue = parseInt(value) || 1;
                    if (processedValue < 1) processedValue = 1;
                }
                
                // Handle decimal scoring inputs
                if (name === 'positiveMarks' || name === 'negativeMarks') {
                    processedValue = parseFloat(value) || 0;
                    if (processedValue < 0) processedValue = 0;
                }
                
                // Handle text/URL inputs
                if (name === 'examName' || name === 'pdfLink') {
                    processedValue = value;
                }
                
                setConfig(prev => ({
                    ...prev,
                    [name]: type === 'checkbox' ? e.target.checked : processedValue
                }));
                
                // Validate field
                validateField(name, processedValue);
            };

            const startExam = (e) => {
                e.preventDefault();
                
                // Validate all fields
                const fieldsToValidate = ['examName', 'questionCount', 'duration', 'positiveMarks', 'negativeMarks'];
                let isValid = true;
                
                fieldsToValidate.forEach(field => {
                    if (!validateField(field, config[field])) {
                        isValid = false;
                    }
                });
                
                if (!isValid) {
                    alert('Please fix the errors in the form');
                    return;
                }
                
                const newSession = {
                    config,
                    answers: {},
                    flags: [],
                    timeLeft: config.duration * 60,
                    startTime: Date.now(),
                    status: 'active'
                };
                localStorage.setItem('omr_current_session', JSON.stringify(newSession));
                window.location.href = 'exam.html';
            };

            return (
                <div className={`min-h-screen pt-24 flex flex-col ${lang === 'bn' ? 'font-bangla' : ''}`}>
                    <Navbar activePage="home" />
                    <PWAStatus />
                    <QuickActions />

                    {/* PWA Modal */}
                    <Modal
                        title={t('pwa_features')}
                        isOpen={showPWAModal}
                        onClose={() => setShowPWAModal(false)}
                        size="md"
                    >
                        <div className="space-y-6">
                            <div className="text-center p-4">
                                <div className="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-xl">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <circle cx="12" cy="12" r="4"/>
                                    </svg>
                                </div>
                                <h4 className="text-xl font-bold text-slate-800 dark:text-white mb-2">
                                    Install OMR Master Pro
                                </h4>
                                <p className="text-slate-600 dark:text-slate-400">
                                    Install this app on your device for a better experience. It works offline and loads faster!
                                </p>
                            </div>
                            
                            <div className="space-y-3">
                                <div className="flex items-center gap-3 p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl border border-blue-200 dark:border-blue-800">
                                    <div className="w-10 h-10 bg-blue-500 text-white rounded-lg flex items-center justify-center">
                                        <Icons.WifiOff className="w-5 h-5" />
                                    </div>
                                    <div>
                                        <p className="font-bold text-slate-800 dark:text-white">{t('pwa_feature_1')}</p>
                                        <p className="text-sm text-slate-600 dark:text-slate-400">Use without internet connection</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3 p-4 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl border border-green-200 dark:border-green-800">
                                    <div className="w-10 h-10 bg-green-500 text-white rounded-lg flex items-center justify-center">
                                        <Icons.Zap className="w-5 h-5" />
                                    </div>
                                    <div>
                                        <p className="font-bold text-slate-800 dark:text-white">{t('pwa_feature_2')}</p>
                                        <p className="text-sm text-slate-600 dark:text-slate-400">Opens instantly like a native app</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3 p-4 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl border border-purple-200 dark:border-purple-800">
                                    <div className="w-10 h-10 bg-purple-500 text-white rounded-lg flex items-center justify-center">
                                        <Icons.Download className="w-5 h-5" />
                                    </div>
                                    <div>
                                        <p className="font-bold text-slate-800 dark:text-white">{t('pwa_feature_3')}</p>
                                        <p className="text-sm text-slate-600 dark:text-slate-400">Easy access from your home screen</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex gap-3 pt-4">
                                <button
                                    onClick={() => {
                                        setShowPWAModal(false);
                                        localStorage.setItem('pwa_prompt_shown', 'true');
                                    }}
                                    className="flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-xl font-bold hover:bg-slate-200 dark:hover:bg-slate-700 transition"
                                >
                                    {t('later')}
                                </button>
                                <button
                                    onClick={() => {
                                        if (window.deferredPrompt) {
                                            window.deferredPrompt.prompt();
                                        }
                                        setShowPWAModal(false);
                                    }}
                                    className="flex-1 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold hover:from-blue-700 hover:to-indigo-700 transition"
                                >
                                    {t('install_now')}
                                </button>
                            </div>
                        </div>
                    </Modal>

                    <main className="flex-grow px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto w-full">
                        
                        {/* Hero Header */}
                        <div className="text-center mb-10 animate-fade-in relative">
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl pointer-events-none animate-float"></div>
                            <h1 className="relative text-4xl md:text-5xl font-extrabold text-slate-900 dark:text-white tracking-tight mb-3">
                                <span className="gradient-text">{t('app_name')}</span> <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500">Pro</span>
                                {isStandalone && (
                                    <span className="ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full align-top">PWA</span>
                                )}
                            </h1>
                            <p className="text-lg text-slate-500 dark:text-slate-400 max-w-2xl mx-auto">
                                {lang === 'en' 
                                    ? 'Professional OMR practice suite with advanced analytics, real-time tracking, and split-screen PDF support.' 
                                    : 'উন্নত অ্যানালিটিক্স, রিয়েল-টাইম ট্র্যাকিং এবং স্প্লিট-স্ক্রিন পিডিএফ সাপোর্ট সহ প্রফেশনাল ওএমআর প্র্যাকটিস স্যুট।'}
                            </p>
                        </div>

                        {/* Stats Row */}
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
                            <div className="glass-panel p-6 rounded-2xl flex flex-col justify-center items-center text-center animate-slide-up hover:shadow-lg transition-all duration-300 advanced-card">
                                <div className="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 font-medium mb-1">
                                    <Icons.BarChart className="w-4 h-4" /> {t('exams_taken')}
                                </div>
                                <div className="text-3xl font-bold text-slate-800 dark:text-white">{stats.total}</div>
                            </div>
                            <div className="glass-panel p-6 rounded-2xl flex flex-col justify-center items-center text-center animate-slide-up hover:shadow-lg transition-all duration-300 advanced-card" style={{animationDelay: '0.1s'}}>
                                <div className="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 font-medium mb-1">
                                    <Icons.Zap className="w-4 h-4" /> {t('avg_score')}
                                </div>
                                <div className="text-3xl font-bold text-blue-600 dark:text-blue-400">{stats.avgScore}</div>
                            </div>
                            <div className="glass-panel p-6 rounded-2xl bg-gradient-to-br from-purple-600 to-purple-700 text-white flex flex-col justify-center items-center text-center shadow-lg shadow-purple-500/30 animate-slide-up cursor-pointer hover:scale-105 transition duration-300 advanced-card" onClick={() => window.location.href='guideline.html'} style={{animationDelay: '0.2s'}}>
                                <div className="text-white/80 text-sm font-medium mb-1">{t('see_how_to_use')}</div>
                                <div className="text-sm font-bold flex items-center gap-1 animate-bounce-subtle">
                                    <Icons.Book className="w-4 h-4" /> View Guide
                                </div>
                            </div>
                            <div className="glass-panel p-6 rounded-2xl bg-gradient-to-br from-blue-600 to-blue-700 text-white flex flex-col justify-center items-center text-center shadow-lg shadow-blue-500/30 animate-slide-up cursor-pointer hover:scale-105 transition duration-300 advanced-card" onClick={() => window.location.href='analytics.html'} style={{animationDelay: '0.3s'}}>
                                <div className="text-white/80 text-sm font-medium mb-1">{t('view_details')}</div>
                                <div className="text-sm font-bold flex items-center gap-1 animate-bounce-subtle">
                                    <Icons.ChevronRight /> {t('analytics')}
                                </div>
                            </div>
                        </div>

                        {/* Resume Card */}
                        {resume && (
                            <div className="mb-8 glass-panel p-6 rounded-2xl border-l-4 border-green-500 shadow-xl transform transition hover:-translate-y-1 cursor-pointer bg-white/80 dark:bg-slate-800/80 advanced-card" onClick={() => window.location.href='exam.html'}>
                                <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                    <div className="w-full">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 text-xs font-bold uppercase tracking-wide animate-pulse">{t('active_session')}</span>
                                            <h3 className="font-bold text-xl text-slate-800 dark:text-white">{resume.config.examName}</h3>
                                        </div>
                                        <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mb-2 overflow-hidden">
                                            <div className="bg-gradient-to-r from-green-500 to-emerald-400 h-2.5 rounded-full transition-all duration-1000" style={{ width: `${(resume.timeLeft / (resume.config.duration * 60)) * 100}%` }}></div>
                                        </div>
                                    </div>
                                    <button className="whitespace-nowrap bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-green-500/30 transition w-full md:w-auto">
                                        {t('resume')}
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Smart Configuration Header */}
                        <div className="mb-8 text-center">
                            <h2 className="text-2xl font-bold text-slate-800 dark:text-white mb-2">{t('smart_config')}</h2>
                            <p className="text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
                                {t('smart_tip')}
                            </p>
                        </div>

                        {/* Main Configuration Form */}
                        <div className="glass-panel rounded-3xl shadow-2xl overflow-hidden animate-slide-up mb-10 border border-white/60 dark:border-slate-700 advanced-card">
                            {/* Form Header */}
                            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-800/50 dark:to-slate-900/50 border-b border-white/50 dark:border-slate-700 p-6 sm:px-8">
                                <div className="flex items-start gap-4">
                                    <div className="p-3 bg-gradient-to-br from-blue-500 to-indigo-500 text-white rounded-xl shadow-lg">
                                        <Icons.Settings className="w-6 h-6" />
                                    </div>
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 dark:text-white mb-1">{t('new_config')}</h2>
                                        <p className="text-sm text-slate-500 dark:text-slate-400">{t('config_sub')}</p>
                                    </div>
                                </div>
                            </div>

                            <form onSubmit={startExam} className="p-6 sm:p-8 space-y-8">
                                
                                {/* 1. Exam Type Selector */}
                                <ExamTypeSelector
                                    value={examType}
                                    onChange={(e) => setExamType(e.target.value)}
                                />

                                {/* 2. Exam Name Input */}
                                <SmartInput
                                    label={t('lbl_exam_name')}
                                    name="examName"
                                    value={config.examName}
                                    onChange={handleChange}
                                    placeholder={t('placeholder_exam')}
                                    icon={Icons.FileText}
                                    required={true}
                                    error={errors.examName}
                                />

                                {/* 3. Enhanced Configuration Grid */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Left Column - Questions & Duration */}
                                    <div className="space-y-8">
                                        {/* Smart Questions Input */}
                                        <div className="p-6 rounded-2xl bg-white/50 dark:bg-slate-900/30 border border-slate-200 dark:border-slate-700">
                                            <SmartNumberInput
                                                label={t('lbl_questions')}
                                                value={config.questionCount}
                                                onChange={handleChange}
                                                min={1}
                                                max={10000}
                                                step={1}
                                                name="questionCount"
                                                suggestions={[1, 10, 25, 50, 100, 200, 500, 1000]}
                                            />
                                            {errors.questionCount && (
                                                <div className="text-red-500 text-sm mt-2">{errors.questionCount}</div>
                                            )}
                                        </div>

                                        {/* Smart Duration Input */}
                                        <div className="p-6 rounded-2xl bg-white/50 dark:bg-slate-900/30 border border-slate-200 dark:border-slate-700">
                                            <SmartDurationInput
                                                label={t('lbl_duration')}
                                                value={config.duration}
                                                onChange={handleChange}
                                                name="duration"
                                            />
                                            {errors.duration && (
                                                <div className="text-red-500 text-sm mt-2">{errors.duration}</div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Right Column - Enhanced Scoring System */}
                                    <div className="space-y-8">
                                        {/* Enhanced Scoring System */}
                                        <div className="p-6 rounded-2xl bg-white/50 dark:bg-slate-900/30 border border-slate-200 dark:border-slate-700">
                                            <h3 className="text-lg font-semibold text-slate-800 dark:text-white mb-6 flex items-center gap-2">
                                                <Icons.Calculator /> {t('scoring_system')}
                                            </h3>
                                            <div className="grid grid-cols-2 gap-6">
                                                <ScoringInput
                                                    label={t('lbl_correct')}
                                                    name="positiveMarks"
                                                    value={config.positiveMarks}
                                                    onChange={handleChange}
                                                    type="positive"
                                                    step={0.01}
                                                />
                                                <ScoringInput
                                                    label={t('lbl_wrong')}
                                                    name="negativeMarks"
                                                    value={config.negativeMarks}
                                                    onChange={handleChange}
                                                    type="negative"
                                                    step={0.01}
                                                />
                                            </div>
                                            
                                            {/* Scoring Impact Preview */}
                                            <div className="mt-6 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
                                                <div className="text-sm text-slate-600 dark:text-slate-400 mb-2">Scoring Impact Preview</div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="text-center p-2 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">For {config.questionCount} correct</div>
                                                        <div className="text-lg font-bold text-green-600 dark:text-green-400">+{(config.questionCount * config.positiveMarks).toFixed(1)}</div>
                                                    </div>
                                                    <div className="text-center p-2 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">Each wrong cancels</div>
                                                        <div className="text-lg font-bold text-red-600 dark:text-red-400">{config.positiveMarks > 0 ? Math.round(config.positiveMarks / config.negativeMarks) : '∞'} correct</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Options Selection */}
                                        <div className="p-6 rounded-2xl bg-white/50 dark:bg-slate-900/30 border border-slate-200 dark:border-slate-700">
                                            <h3 className="text-lg font-semibold text-slate-800 dark:text-white mb-4">{t('lbl_options')}</h3>
                                            <div className="grid grid-cols-3 gap-2">
                                                {[2, 3, 4, 5, 6].map(num => (
                                                    <button
                                                        key={num}
                                                        type="button"
                                                        onClick={() => setConfig(prev => ({...prev, optionsCount: num}))}
                                                        className={`py-4 rounded-lg border-2 transition-all ${config.optionsCount === num ? 'bg-blue-500 text-white border-blue-500 shadow-lg' : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-blue-300'}`}
                                                    >
                                                        <div className="font-bold text-lg">
                                                            {Array.from({length: num}, (_, i) => String.fromCharCode(65 + i)).join('')}
                                                        </div>
                                                        <div className="text-xs opacity-80">{num} Options</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 4. PDF Link Input */}
                                <SmartInput
                                    label={t('lbl_pdf')}
                                    name="pdfLink"
                                    value={config.pdfLink}
                                    onChange={handleChange}
                                    placeholder={t('placeholder_pdf')}
                                    icon={Icons.Link}
                                    type="url"
                                />

                                {/* 5. Advanced Settings Toggle */}
                                <div className="flex justify-center">
                                    <button
                                        type="button"
                                        onClick={() => setShowAdvanced(!showAdvanced)}
                                        className="flex items-center gap-2 text-blue-600 dark:text-blue-400 font-semibold hover:gap-3 transition-all px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl"
                                    >
                                        {t('btn_advanced')}
                                        <Icons.ChevronRight className={`transition-transform duration-300 ${showAdvanced ? 'rotate-90' : ''}`} />
                                    </button>
                                </div>

                                {/* 6. Advanced Settings Section */}
                                {showAdvanced && (
                                    <div className="p-6 rounded-2xl bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 animate-fade-in">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <label className="flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                                <div className="flex items-center gap-3">
                                                    <input
                                                        type="checkbox"
                                                        name="shuffleQuestions"
                                                        checked={config.shuffleQuestions}
                                                        onChange={handleChange}
                                                        className="custom-checkbox"
                                                    />
                                                    <div>
                                                        <div className="font-medium text-slate-800 dark:text-white">{t('shuffle_questions')}</div>
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">Randomize question order</div>
                                                    </div>
                                                </div>
                                            </label>
                                            <label className="flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                                <div className="flex items-center gap-3">
                                                    <input
                                                        type="checkbox"
                                                        name="showTimer"
                                                        checked={config.showTimer}
                                                        onChange={handleChange}
                                                        className="custom-checkbox"
                                                    />
                                                    <div>
                                                        <div className="font-medium text-slate-800 dark:text-white">{t('show_timer')}</div>
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">Display countdown timer</div>
                                                    </div>
                                                </div>
                                            </label>
                                            <label className="flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                                <div className="flex items-center gap-3">
                                                    <input
                                                        type="checkbox"
                                                        name="autoSubmit"
                                                        checked={config.autoSubmit}
                                                        onChange={handleChange}
                                                        className="custom-checkbox"
                                                    />
                                                    <div>
                                                        <div className="font-medium text-slate-800 dark:text-white">{t('auto_submit')}</div>
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">Auto submit when time ends</div>
                                                    </div>
                                                </div>
                                            </label>
                                            <label className="flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                                <div className="flex items-center gap-3">
                                                    <input
                                                        type="checkbox"
                                                        name="enableSound"
                                                        checked={config.enableSound}
                                                        onChange={handleChange}
                                                        className="custom-checkbox"
                                                    />
                                                    <div>
                                                        <div className="font-medium text-slate-800 dark:text-white">{t('enable_sound')}</div>
                                                        <div className="text-xs text-slate-500 dark:text-slate-400">Enable sound notifications</div>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                )}

                                {/* 7. Enhanced Live Preview Section */}
                                <div className="p-6 rounded-2xl bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100 dark:border-blue-800">
                                    <h3 className="text-lg font-semibold text-slate-800 dark:text-white mb-6 flex items-center gap-2">
                                        <Icons.BarChart /> {t('preview')}
                                    </h3>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm">
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mb-1">{t('total_time')}</div>
                                            <div className="text-xl font-bold text-blue-600 dark:text-blue-400">{calculatedMetrics.totalTimeFormatted}</div>
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                                {config.duration} minutes
                                            </div>
                                        </div>
                                        <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm">
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mb-1">{t('scoring_system')}</div>
                                            <div className="text-xl font-bold text-green-600 dark:text-green-400">+{config.positiveMarks}</div>
                                            <div className="text-sm font-bold text-red-600 dark:text-red-400">-{config.negativeMarks}</div>
                                        </div>
                                        <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm">
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mb-1">{t('question_density')}</div>
                                            <div className="text-xl font-bold text-purple-600 dark:text-purple-400">{calculatedMetrics.questionDensity}</div>
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                                per minute
                                            </div>
                                        </div>
                                        <div className="text-center p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm">
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mb-1">{t('estimated_speed')}</div>
                                            <div className="text-xl font-bold text-amber-600 dark:text-amber-400">{calculatedMetrics.timePerQuestion}s</div>
                                            <div className="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                                per question
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Additional Metrics */}
                                    <div className="mt-6 grid grid-cols-2 gap-4">
                                        <div className="p-3 bg-white dark:bg-slate-800 rounded-lg">
                                            <div className="text-xs text-slate-500 dark:text-slate-400">Max Score</div>
                                            <div className="text-lg font-bold text-slate-800 dark:text-white">{calculatedMetrics.maxScore}</div>
                                        </div>
                                        <div className="p-3 bg-white dark:bg-slate-800 rounded-lg">
                                            <div className="text-xs text-slate-500 dark:text-slate-400">Passing Score</div>
                                            <div className="text-lg font-bold text-green-600 dark:text-green-400">{calculatedMetrics.passingScore}+</div>
                                        </div>
                                    </div>
                                </div>

                                {/* 8. Helpful Tips */}
                                <div className="p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/10 dark:to-cyan-900/10 rounded-2xl border border-blue-100 dark:border-blue-800">
                                    <div className="flex items-center gap-2 mb-3">
                                        <Icons.Info className="w-5 h-5 text-blue-500" />
                                        <span className="font-semibold text-blue-700 dark:text-blue-300">{t('tips')}</span>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full mt-1.5"></div>
                                            <span className="text-slate-600 dark:text-slate-400">{t('tip_1')}</span>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full mt-1.5"></div>
                                            <span className="text-slate-600 dark:text-slate-400">{t('tip_2')}</span>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full mt-1.5"></div>
                                            <span className="text-slate-600 dark:text-slate-400">{t('tip_3')}</span>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-blue-500 rounded-full mt-1.5"></div>
                                            <span className="text-slate-600 dark:text-slate-400">{t('tip_4')}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* 9. Submit Button */}
                                <div className="relative">
                                    <button 
                                        type="submit" 
                                        disabled={!config.examName.trim() || Object.keys(errors).length > 0}
                                        className={`w-full py-5 rounded-xl shadow-xl transform transition-all duration-300 flex items-center justify-center gap-3 overflow-hidden relative group ${!config.examName.trim() || Object.keys(errors).length > 0 ? 'bg-slate-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-700 hover:from-blue-700 hover:via-indigo-700 hover:to-blue-800 text-white shadow-blue-500/30 hover:scale-[1.02] hover:shadow-2xl hover:shadow-blue-500/40'}`}
                                    >
                                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></div>
                                        <span className="relative z-10 flex items-center gap-3 text-lg font-bold">
                                            {config.examName.trim() && Object.keys(errors).length === 0 ? (
                                                <>
                                                    <Icons.Play className="w-6 h-6" />
                                                    {t('btn_start')}
                                                    <span className="text-sm font-normal opacity-90">({config.questionCount} questions, {calculatedMetrics.totalTimeFormatted})</span>
                                                </>
                                            ) : (
                                                <span className="text-sm uppercase tracking-widest">
                                                    {Object.keys(errors).length > 0 ? 'Fix errors to continue' : t('err_name_req')}
                                                </span>
                                            )}
                                        </span>
                                    </button>
                                    
                                    {config.examName.trim() && Object.keys(errors).length === 0 && (
                                        <div className="mt-3 text-center text-sm text-slate-500 dark:text-slate-400 animate-fade-in">
                                            {lang === 'en' 
                                                ? `Max score: ${calculatedMetrics.maxScore} • Passing: ${calculatedMetrics.passingScore}+ • Time per question: ${calculatedMetrics.timePerQuestion}s`
                                                : `সর্বোচ্চ স্কোর: ${calculatedMetrics.maxScore} • পাসিং: ${calculatedMetrics.passingScore}+ • প্রতি প্রশ্নে সময়: ${calculatedMetrics.timePerQuestion}s`
                                            }
                                        </div>
                                    )}
                                </div>
                            </form>
                        </div>
                    </main>

                    <Footer />
                </div>
            );
        };

        const AppWrapper = () => {
            const [lang, setLang] = useState('en');
            const [darkMode, setDarkMode] = useState(false);
            const [isStandalone, setIsStandalone] = useState(false);

            useEffect(() => {
                // Load saved preferences
                const savedLang = localStorage.getItem('lang');
                if (savedLang) setLang(savedLang);

                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }

                // Check PWA status
                const checkPWA = window.matchMedia('(display-mode: standalone)').matches;
                setIsStandalone(checkPWA);
                
                // Add PWA specific classes
                if (checkPWA) {
                    document.body.classList.add('pwa-installed');
                }
                
                // Listen for PWA status changes
                const handlePWAStatus = (e) => {
                    setIsStandalone(e.detail.isStandalone);
                    if (e.detail.isStandalone) {
                        document.body.classList.add('pwa-installed');
                    } else {
                        document.body.classList.remove('pwa-installed');
                    }
                };
                
                window.addEventListener('pwaStatusChanged', handlePWAStatus);
                
                return () => window.removeEventListener('pwaStatusChanged', handlePWAStatus);
            }, []);

            return (
                <AppContext.Provider value={{ lang, setLang, darkMode, setDarkMode }}>
                    <Home />
                </AppContext.Provider>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AppWrapper />);
    </script>
</body>
</html>